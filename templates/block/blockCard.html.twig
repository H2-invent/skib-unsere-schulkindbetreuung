{% if blocks is defined %}
    {% for b in blocks %}
        <div class="card">
            <div class="card-body text-center {% if b.deleted == true %}bg-danger collapse{% endif %}"
                 id="deletedCollape-{{ b.id }}">
                {% if getAnzahlBeworbenKids(b)|length > 0 %}
                    <span class="badge badge-danger">{{ getAnzahlBeworbenKids(b)|length }}</span>
                {% endif %}
                {% if b.deaktiviert %}
                    <div class="disabled">{{ 'Dieser Block ist nicht mehr buchbar'|trans }}</div>
                    <hr>
                {% endif %}
                <p>
                    {{ b.ganztagString }}{% if b.ganztag == 0 %}<i class="material-icons">restaurant</i> {% endif %}

                </p>
                {% if b.min is not null or b.max is not null %}
                    <small>
                        {{ 'Kontingent'|trans }}
                    </small>
                {% endif %}
                <p>{{ b.von|date('H:i') }}-{{ b.bis|date('H:i') }}</p>
                {% if b.vorganger is not empty %}
                    <ul class="list-group">
                        <li class="list-group-item">Vorgänger:</li>
                        {% for l in b.vorganger %}
                            <li class="list-group-item">{{ l.wochentagString }} {{ l.von|date('H:i') }}
                                -{{ l.bis|date('H:i') }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <p>
                    <a class="btn btn-primary" data-toggle="collapse" href="#collapse{{ b.id }}" role="button"
                       aria-expanded="false" aria-controls="collapseExample">
                        {% trans %}Detail{% endtrans %}
                    </a>

                </p>
                <div class="collapse" id="collapse{{ b.id }}">
                    <div class="card card-body">
                        <p>{% trans %}Kinder{% endtrans %}: {{ b.kindwithFin|length }}</p>
                        {% if b.min is not null and b.max is not null %}
                            <p>{% trans %}Min{% endtrans %}: {{ b.min }}</p>
                            <p>{% trans %}Max{% endtrans %}: {{ b.max }}</p>
                            <b>{% trans %}Angemeldete Kinder{% endtrans %}:</b>
                            {{ b.BeworbenwithFin|length }}
                        {% endif %}
                        <p>{% trans %}Preise{% endtrans %}:</p>
                        <ul class="list-group">
                            {% for p in b.preise %}
                                <li class="list-group-item">{{ p|number_format(2,',') }}€</li>{% endfor %}
                        </ul>

                    </div>
                </div>
                {% if b.deleted == true and  is_granted('ROLE_ORG_BLOCK_DELETE') %}

                    <a href="{{ path('block_schule_restoreBlocks',{'id':b.id}) }}" class="deleteBtn" type="GET"
                       successFKT="reloadBlocks"><i
                                class="material-icons">restore_from_trash</i></a>

                {% endif %}
            </div>
            <div class="bmd-card-actions text-center">

                {% if b.deleted == false %}
                    <button class="btn bmd-btn-icon dropdown-toggle" type="button" id="ex2" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <i class="material-icons">more_vert</i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-left" aria-labelledby="ex2" style="width: max-content">

                        {% if is_granted('ROLE_ORG_CHILD_SHOW') %}
                            <a class="dropdown-item"
                               href="{{ path('child_show',{'id':b.schule.organisation.id,'block':b.id}) }}"><i
                                        class="material-icons">info</i> Info</a>
                        {% endif %}
                        {% if is_granted('ROLE_ORG_BLOCK_MANAGEMENT') %}
                            <a href="{{ path('block_schule_editBlocks',{'id':b.id}) }}"
                               class="loadContent dropdown-item"> <i
                                        class="material-icons">edit</i> Bearbeiten</a>
                            <a href="{{ path('block_schule_linkBlock',{'id':b.id}) }}"
                               class="loadContent dropdown-item"><i
                                        class="material-icons">link</i> Verknüpfen</a>

                        {% endif %}
                        {% if is_granted('ROLE_ORG_BLOCK_DELETE') %}
                            <a href="{{ path('block_schule_deleteBlocks',{'id':b.id}) }}"
                               class="deleteBtn dropdown-item" type="PUT"
                               successFKT="reloadBlocks"><i
                                        class="material-icons">delete</i> Löschen</a>
                        {% endif %}
                        {% if is_granted('ROLE_ORG_BLOCK_DEACTIVATE') %}
                            <a href="{{ path('app_deactivate_zeitblock_index',{'id':b.id}) }}"
                               class="deleteBtn dropdown-item" type="PUT"
                               successFKT="reloadBlocks"><i
                                        class="material-icons">disabled_by_default</i>{%if b.deaktiviert%}Buchbarkeit aktivieren{%else%}Buchbarkeit deaktivieren{%endif%}</a>
                        {% endif %}
                        {% if is_granted('ROLE_ORG_ACCEPT_CHILD') and (b.min is not null or b.max is not null) and getAnzahlBeworbenKids(b)|length>0 %}

                            {% if (b.max is not null and (b.beworbenwithFin|length + b.kindwithFin|length) <= b.max) or b.min is not null %}
                                <a href="{{ path('kontingent_accept_all_kids',{'block_id':b.id}) }}"
                                   class="deleteBtn dropdown-item" successFKT="reloadBlocks"><i
                                            class="material-icons">check</i>&nbsp;Alle Kinder zulassen</a>
                            {% endif %}

                            <a class="dropdown-item" href="{{ path('kontingent_show_kids',{'block_id':b.id}) }}"><i
                                        class="material-icons">person_add</i>&nbsp;Kinder einzeln zulassen
                            </a>
                        {% endif %}
                    </div>





                {% else %}
                    <a data-toggle="collapse" href="#deletedCollape-{{ b.id }}" role="button" aria-expanded="false"
                       aria-controls="collapseExample"> {% trans %}gelöscht{% endtrans %}
                        /{% trans %}deaktiviert{% endtrans %}</a>
                {% endif %}
            </div>
        </div>
    {% endfor %}
{% endif %}
