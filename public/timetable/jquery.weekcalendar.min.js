(function(h){var g=h.fn.jquery.split("."),b=(10*g[0]+g[1])<15;h.widget("ui.weekCalendar",(function(){var j,i;return{options:{date:new Date(),timeFormat:null,dateFormat:"M d, Y",alwaysDisplayTimeMinutes:true,use24Hour:false,daysToShow:7,minBodyHeight:100,firstDayOfWeek:function(k){if(h(k).weekCalendar("option","daysToShow")!=5){return 0}else{return 1}},useShortDayNames:false,timeSeparator:" to ",startParam:"start",endParam:"end",businessHours:{start:8,end:18,limitDisplay:false},newEventText:"New Event",timeslotHeight:20,defaultEventLength:2,timeslotsPerHour:4,minDate:null,maxDate:null,showHeader:true,buttons:true,buttonText:{today:"today",lastWeek:"previous",nextWeek:"next"},switchDisplay:{},scrollToHourMillis:500,allowEventDelete:false,allowCalEventOverlap:false,overlapEventsSeparate:false,totalEventsWidthPercentInOneColumn:100,readonly:false,allowEventCreation:true,hourLine:false,deletable:function(l,k){return true},draggable:function(l,k){return true},resizable:function(l,k){return true},eventClick:function(o,l,m,n,k){},eventRender:function(l,k){return k},eventAfterRender:function(l,k){return k},eventRefresh:function(l,k){return k},eventDrag:function(l,k){},eventDrop:function(l,k){},eventResize:function(l,k){},eventNew:function(o,k,l,n,m){},eventMouseover:function(l,k){},eventMouseout:function(l,k){},eventDelete:function(o,l,m,n,k){n.weekCalendar("removeEvent",o.id)},calendarBeforeLoad:function(k){},calendarAfterLoad:function(k){},noEvents:function(){},eventHeader:function(o,n){var l=n.weekCalendar("option");var k=3600000;var m=o.end.getTime()-o.start.getTime()<=(k/l.timeslotsPerHour);if(m){return n.weekCalendar("formatTime",o.start)+": "+o.title}else{return n.weekCalendar("formatTime",o.start)+l.timeSeparator+n.weekCalendar("formatTime",o.end)}},eventBody:function(l,k){return l.title},shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],users:[],showAsSeparateUsers:true,getUserId:function(k,l,m){return l},getUserName:function(k,l,m){return k},getEventUserId:function(l,k){return l.userId},setEventUserId:function(k,m,l){m.userId=k;return m},displayFreeBusys:false,getFreeBusyUserId:function(k,l){return k.userId},defaultFreeBusy:{free:false},freeBusyRender:function(k,m,l){if(!k.free){m.addClass("free-busy-busy")}else{m.addClass("free-busy-free")}return m},startOnFirstDayOfWeek:function(k){return h(k).weekCalendar("option","daysToShow")>=5},displayOddEven:false,textSize:13,title:"%start% - %end%",jsonOptions:{},headerSeparator:"<br />",getHeaderDate:null,preventDragOnEventCreation:false,resizeEvent:"resize.weekcalendar"},_create:function(){var k=this;k._computeOptions();k._setupEventDelegation();k._renderCalendar();k._loadCalEvents();k._resizeCalendar();k._scrollToHour(k.options.date.getHours(),true);if(this.options.resizeEvent){h(window).unbind(this.options.resizeEvent);h(window).bind(this.options.resizeEvent,function(){k._resizeCalendar()})}},refresh:function(){this._loadCalEvents(this.element.data("startDate"))},clear:function(){this._clearCalendar()},today:function(){this._clearCalendar();this._loadCalEvents(new Date())},prevWeek:function(){var k=new Date(this.element.data("startDate").getTime()-(c/6));this._clearCalendar();this._loadCalEvents(k)},nextWeek:function(){var k=new Date(this.element.data("startDate").getTime()+c+a);this._clearCalendar();this._loadCalEvents(k)},gotoWeek:function(k){this._clearCalendar();this._loadCalEvents(k)},gotoDate:function(k){this._clearCalendar();this._loadCalEvents(k)},setDaysToShow:function(m){var l=this;var k=l._getCurrentScrollHour();l.options.daysToShow=m;h(l.element).html("");l._renderCalendar();l._loadCalEvents();l._resizeCalendar();l._scrollToHour(k,false);if(this.options.resizeEvent){h(window).unbind(this.options.resizeEvent);h(window).bind(this.options.resizeEvent,function(){l._resizeCalendar()})}},removeEvent:function(l){var k=this;k.element.find(".wc-cal-event").each(function(){if(h(this).data("calEvent").id===l){h(this).remove();return false}});k.element.find(".wc-day-column-inner").each(function(){k._adjustOverlappingEvents(h(this))})},removeUnsavedEvents:function(){var k=this;k.element.find(".wc-new-cal-event").each(function(){h(this).remove()});k.element.find(".wc-day-column-inner").each(function(){k._adjustOverlappingEvents(h(this))})},updateEvent:function(k){this._updateEventInCalendar(k)},getTimeslotTimes:function(n){var m=this.options;var l=m.businessHours.limitDisplay?m.businessHours.start:0;var k=new Date(n.getFullYear(),n.getMonth(),n.getDate(),l);var r=[],p=k.getTime();for(var o=0;o<m.timeslotsPerDay;o++){var q=p+m.millisPerTimeslot;r[o]={start:new Date(p),startFormatted:this.formatTime(new Date(p),m.timeFormat),end:new Date(q),endFormatted:this.formatTime(new Date(q),m.timeFormat)};p=q}return r},formatDate:function(k,l){if(l){return this._formatDate(k,l)}else{return this._formatDate(k,this.options.dateFormat)}},formatTime:function(k,l){if(l){return this._formatDate(k,l)}else{if(this.options.timeFormat){return this._formatDate(k,this.options.timeFormat)}else{if(this.options.use24Hour){return this._formatDate(k,"H:i")}else{return this._formatDate(k,"h:i a")}}}},serializeEvents:function(){var k=this;var l=[];k.element.find(".wc-cal-event").each(function(){l.push(h(this).data("calEvent"))});return l},next:function(){if(this._startOnFirstDayOfWeek()){return this.nextWeek()}var k=new Date(this.element.data("startDate").getTime());k.setDate(k.getDate()+this.options.daysToShow);this._clearCalendar();this._loadCalEvents(k)},prev:function(){if(this._startOnFirstDayOfWeek()){return this.prevWeek()}var k=new Date(this.element.data("startDate").getTime());k.setDate(k.getDate()-this.options.daysToShow);this._clearCalendar();this._loadCalEvents(k)},getCurrentFirstDay:function(){return this._dateFirstDayOfWeek(this.options.date||new Date())},getCurrentLastDay:function(){return this._addDays(this.getCurrentFirstDay(),this.options.daysToShow-1)},_setOption:function(m,n){var l=this;if(l.options[m]!=n){if(m=="beforeEventNew"){l.options[m]=n;return}var k=l.element.find(".wc-cal-event").map(function(){return h(this).data("calEvent")});var o={};o[m]=n;l._renderEvents({events:k,options:o},l.element.find(".wc-day-column-inner"))}},_computeOptions:function(){var k=this.options;if(k.businessHours.limitDisplay){k.timeslotsPerDay=k.timeslotsPerHour*(k.businessHours.end-k.businessHours.start);k.millisToDisplay=(k.businessHours.end-k.businessHours.start)*3600000;k.millisPerTimeslot=k.millisToDisplay/k.timeslotsPerDay}else{k.timeslotsPerDay=k.timeslotsPerHour*24;k.millisToDisplay=a;k.millisPerTimeslot=a/k.timeslotsPerDay}},_resizeCalendar:function(){var m=this.options;if(m&&h.isFunction(m.height)){var p=m.height(this.element);var k=this.element.find(".wc-header").outerHeight();var o=this.element.find(".wc-toolbar").outerHeight();var n=Math.max(p-o-k,m.minBodyHeight);var l=this.element.find(".wc-time-slots").outerHeight();this.element.find(".wc-scrollable-grid").height(n);if(l<=n){this.element.find(".wc-scrollbar-shim").width(0)}else{this.element.find(".wc-scrollbar-shim").width(this._findScrollBarWidth())}this._trigger("resize",this.element)}},_findScrollBarWidth:function(){var l=h('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");var m=l.children();var k=m.innerWidth()-m.height(99).innerWidth();l.remove();return k||16},_setupEventDelegation:function(){var k=this;var l=this.options;this.element.click(function(n){var m=h(n.target),p;if(m.data("preventClick")){return}var o=m.hasClass("wc-cal-event")?m:m.parents(".wc-cal-event");if(!o.length||!o.data("calEvent")){return}p=k.getFreeBusyManagerForEvent(o.data("calEvent"));if(l.allowEventDelete&&m.hasClass("wc-cal-event-delete")){l.eventDelete(o.data("calEvent"),o,p,k.element,n)}else{l.eventClick(o.data("calEvent"),o,p,k.element,n)}}).mouseover(function(n){var m=h(n.target);var o=m.hasClass("wc-cal-event")?m:m.parents(".wc-cal-event");if(!o.length||!o.data("calEvent")){return}if(k._isDraggingOrResizing(o)){return}l.eventMouseover(o.data("calEvent"),o,n)}).mouseout(function(n){var m=h(n.target);var o=m.hasClass("wc-cal-event")?m:m.parents(".wc-cal-event");if(!o.length||!o.data("calEvent")){return}if(k._isDraggingOrResizing(o)){return}l.eventMouseout(o.data("calEvent"),o,n)})},_isDraggingOrResizing:function(k){return k.hasClass("ui-draggable-dragging")||k.hasClass("ui-resizable-resizing")},_renderCalendar:function(){var n,k;var l=this;var m=this.options;n=h('<div class="ui-widget wc-container">').appendTo(l.element);l._renderCalendarButtons(n);l._renderCalendarHeader(n);l._renderCalendarBody(n);k=n.find(".wc-day-column-inner");k.each(function(o,p){if(!m.readonly){l._addDroppableToWeekDay(h(this));if(m.allowEventCreation){l._setupEventCreationForWeekDay(h(this))}}})},_renderCalendarButtons:function(p){var l=this,m=this.options;if(!m.showHeader){return}if(m.buttons){var k="";k+='<div class="ui-widget-header wc-toolbar">';k+='<div class="wc-display"></div>';k+='<div class="wc-nav">';k+='<button class="wc-prev">'+m.buttonText.lastWeek+"</button>";k+='<button class="wc-today">'+m.buttonText.today+"</button>";k+='<button class="wc-next">'+m.buttonText.nextWeek+"</button>";k+="</div>";k+='<h1 class="wc-title"></h1>';k+="</div>";h(k).appendTo(p);p.find(".wc-nav .wc-today").button({icons:{primary:"ui-icon-home"}}).click(function(){l.today();return false});p.find(".wc-nav .wc-prev").button({text:false,icons:{primary:"ui-icon-seek-prev"}}).click(function(){l.element.weekCalendar("prev");return false});p.find(".wc-nav .wc-next").button({text:false,icons:{primary:"ui-icon-seek-next"}}).click(function(){l.element.weekCalendar("next");return false});if(this.options.switchDisplay&&h.isPlainObject(this.options.switchDisplay)){var o=p.find(".wc-display");h.each(this.options.switchDisplay,function(q,s){var r="wc-switch-display-"+s;var t=h('<input type="radio" id="'+r+'" name="wc-switch-display" class="wc-switch-display"/>');var u=h('<label for="'+r+'"></label>');u.html(q);t.val(s);if(parseInt(l.options.daysToShow,10)===parseInt(s,10)){t.attr("checked","checked")}o.append(t).append(u)});o.find("input").change(function(){l.setDaysToShow(parseInt(h(this).val(),10))})}p.find(".wc-nav, .wc-display").buttonset();var n=p.find(".wc-nav").outerHeight();p.find(".wc-title").height(n).css("line-height",n+"px")}else{var k="";k+='<div class="ui-widget-header wc-toolbar">';k+='<h1 class="wc-title"></h1>';k+="</div>";h(k).appendTo(p)}},_renderCalendarHeader:function(r){var s=this,u=this.options,k=u.showAsSeparateUsers&&u.users&&u.users.length,n="",l="",t;if(k){n=' rowspan="2"';l=' colspan="'+u.users.length+'" '}t='<div class="ui-widget-content wc-header">';t+='<table><tbody><tr><td class="wc-time-column-header"></td>';for(var p=1;p<=u.daysToShow;p++){t+='<td class="wc-day-column-header wc-day-'+p+'"'+l+"></td>"}t+='<td class="wc-scrollbar-shim"'+n+"></td></tr>";if(k){t+='<tr><td class="wc-time-column-header"></td>';var q=u.users.length,m="";for(var p=1;p<=u.daysToShow;p++){for(var o=0;o<q;o++){m=[];if(o==0){m.push("wc-day-column-first")}if(o==q-1){m.push("wc-day-column-last")}if(!m.length){m="wc-day-column-middle"}else{m=m.join(" ")}t+='<td class="'+m+" wc-user-header wc-day-"+p+" wc-user-"+s._getUserIdFromIndex(o)+'">';t+=s._getUserName(o);t+="</td>"}}t+="</tr>"}t+="</tbody></table></div>";h(t).appendTo(r)},_renderCalendarBody:function(r){var m=this,o=this.options,k=o.showAsSeparateUsers&&o.users&&o.users.length,n,l;n='<div class="wc-scrollable-grid">';n+='<table class="wc-time-slots">';n+="<tbody>";n+="</tbody>";n+="</table>";n+="</div>";n=h(n);l=n.find("tbody");m._renderCalendarBodyTimeSlots(l);m._renderCalendarBodyOddEven(l);m._renderCalendarBodyFreeBusy(l);m._renderCalendarBodyEvents(l);n.appendTo(r);r.find(".wc-full-height-column").height(o.timeslotHeight*o.timeslotsPerDay);r.find(".wc-time-slot").height(o.timeslotHeight-1);r.find(".wc-time-header-cell").css({height:(o.timeslotHeight*o.timeslotsPerHour)-11,padding:5});if(k){for(var p=0,q=o.users.length;p<q;p++){r.find(".wc-user-"+m._getUserIdFromIndex(p)).data("wcUser",o.users[p]).data("wcUserIndex",p).data("wcUserId",m._getUserIdFromIndex(p))}}},_renderCalendarBodyTimeSlots:function(q){var s=this.options,r,p,o,l=s.showAsSeparateUsers&&s.users&&s.users.length,k=(s.businessHours.limitDisplay?s.businessHours.start:0),n=(s.businessHours.limitDisplay?s.businessHours.end:24),m=1;if(s.displayOddEven){m+=1}if(s.displayFreeBusys){m+=1}if(m>1){m=' rowspan="'+m+'"'}else{m=""}r='<tr class="wc-grid-row-timeslot">';r+='<td class="wc-grid-timeslot-header"'+m+"></td>";r+='<td colspan="'+s.daysToShow*(l?s.users.length:1)+'">';r+='<div class="wc-no-height-wrapper wc-time-slot-wrapper">';r+='<div class="wc-time-slots">';for(p=k;p<n;p++){for(o=0;o<s.timeslotsPerHour-1;o++){r+='<div class="wc-time-slot"></div>'}r+='<div class="wc-time-slot wc-hour-end"></div>'}r+="</div>";r+="</div>";r+="</td>";r+="</tr>";h(r).appendTo(q)},_renderCalendarBodyOddEven:function(p){if(this.options.displayOddEven){var s=this.options,q='<tr class="wc-grid-row-oddeven">',k=s.showAsSeparateUsers&&s.users&&s.users.length,r,l={odd:"wc-column-odd",even:"ui-state-hover wc-column-even"};for(var n=1;n<=s.daysToShow;n++){if(!k){r=(r=="odd"?"even":"odd");q+='<td class="wc-day-column day-'+n+'">';q+='<div class="wc-no-height-wrapper wc-oddeven-wrapper">';q+='<div class="wc-full-height-column '+l[r]+'"></div>';q+="</div>";q+="</td>"}else{var o=s.users.length;for(var m=0;m<o;m++){r=(r=="odd"?"even":"odd");q+='<td class="wc-day-column day-'+n+'">';q+='<div class="wc-no-height-wrapper wc-oddeven-wrapper">';q+='<div class="wc-full-height-column '+l[r]+'" ></div>';q+="</div>";q+="</td>"}}}q+="</tr>";h(q).appendTo(p)}},_renderCalendarBodyFreeBusy:function(n){if(this.options.displayFreeBusys){var m=this,p=this.options,l='<tr class="wc-grid-row-freebusy">',k=p.showAsSeparateUsers&&p.users&&p.users.length;l+="</td>";for(var q=1;q<=p.daysToShow;q++){if(p.displayFreeBusys){if(!k){l+='<td class="wc-day-column day-'+q+'">';l+='<div class="wc-no-height-wrapper wc-freebusy-wrapper">';l+='<div class="wc-full-height-column wc-column-freebusy wc-day-'+q+'"></div>';l+="</div>";l+="</td>"}else{var r=p.users.length;for(var o=0;o<r;o++){l+='<td class="wc-day-column day-'+q+'">';l+='<div class="wc-no-height-wrapper wc-freebusy-wrapper">';l+='<div class="wc-full-height-column wc-column-freebusy wc-day-'+q;l+=" wc-user-"+m._getUserIdFromIndex(o)+'">';l+="</div>";l+="</div>";l+="</td>"}}}}l+="</tr>";h(l).appendTo(n)}},_renderCalendarBodyEvents:function(t){var u=this,w=this.options,v,m=w.showAsSeparateUsers&&w.users&&w.users.length,l=(w.businessHours.limitDisplay?w.businessHours.start:0),n=(w.businessHours.limitDisplay?w.businessHours.end:24);v='<tr class="wc-grid-row-events">';v+='<td class="wc-grid-timeslot-header">';for(var q=l;q<n;q++){var k=(w.businessHours.start<=q&&w.businessHours.end>q)?"ui-state-active wc-business-hours":"ui-state-default";v+='<div class="wc-hour-header '+k+'">';if(w.use24Hour){v+='<div class="wc-time-header-cell">'+u._24HourForIndex(q)+"</div>"}else{v+='<div class="wc-time-header-cell">'+u._hourForIndex(q)+'<span class="wc-am-pm">'+u._amOrPm(q)+"</span></div>"}v+="</div>"}v+="</td>";var p="ui-state-default wc-day-column";for(var q=1;q<=w.daysToShow;q++){if(!m){v+='<td class="'+p+" wc-day-column-first wc-day-column-last day-"+q+'">';v+='<div class="wc-full-height-column wc-day-column-inner day-'+q+'"></div>';v+="</td>"}else{var s=w.users.length;var r;for(var o=0;o<s;o++){r=[];if(o==0){r.push("wc-day-column-first")}if(o==s-1){r.push("wc-day-column-last")}if(!r.length){r="wc-day-column-middle"}else{r=r.join(" ")}v+='<td class="'+p+" "+r+" day-"+q+'">';v+='<div class="wc-full-height-column wc-day-column-inner day-'+q;v+=" wc-user-"+u._getUserIdFromIndex(o)+'">';v+="</div>";v+="</td>"}}}v+="</tr>";h(v).appendTo(t)},_setupEventCreationForWeekDay:function(k){var l=this;var m=this.options;k.mousedown(function(s){var n=h(s.target);if(n.hasClass("wc-day-column-inner")){var q=h('<div class="wc-cal-event wc-new-cal-event wc-new-cal-event-creating"></div>');q.css({lineHeight:(m.timeslotHeight-2)+"px",fontSize:(m.timeslotHeight/2)+"px"});n.append(q);var r=n.offset().top;var t=s.pageY-r;var o=(t-(t%m.timeslotHeight))/m.timeslotHeight;var p=o*m.timeslotHeight;q.css({top:p});if(!m.preventDragOnEventCreation){n.bind("mousemove.newevent",function(w){q.show();q.addClass("ui-resizable-resizing");var u=Math.round(w.pageY-r-p);var x=u%m.timeslotHeight;if(x<0){var v=u-x;q.css("height",v<m.timeslotHeight?m.timeslotHeight:v)}else{q.css("height",u+(m.timeslotHeight-x))}}).mouseup(function(){n.unbind("mousemove.newevent");q.addClass("ui-corner-all")})}}}).mouseup(function(o){var s=h(o.target);var p=s.closest(".wc-day-column-inner");var n=p.find(".wc-new-cal-event-creating");if(n.length){var t=!n.hasClass("ui-resizable-resizing");if(t){n.css({height:m.timeslotHeight*m.defaultEventLength}).show()}var w=parseInt(n.css("top"));var r=l._getEventDurationFromPositionedEventElement(p,n,w);n.remove();var x={start:r.start,end:r.end,title:m.newEventText};var q=m.showAsSeparateUsers&&m.users&&m.users.length;if(q){x=l._setEventUserId(x,p.data("wcUserId"))}else{if(!m.showAsSeparateUsers&&m.users&&m.users.length==1){x=l._setEventUserId(x,l._getUserIdFromIndex(0))}}var u=l.getFreeBusyManagerForEvent(x);var y=l._renderEvent(x,p);if(!m.allowCalEventOverlap){l._adjustForEventCollisions(p,y,x,x);l._positionEvent(p,y)}else{l._adjustOverlappingEvents(p)}var v=l._trigger("beforeEventNew",o,{calEvent:x,createdFromSingleClick:t,calendar:l.element});if(v){m.eventNew(x,y,u,l.element,o)}else{h(y).remove()}}})},_loadCalEvents:function(q){var p,k,m,l;var n=this;var o=this.options;p=this._fixMinMaxDate(q||o.date);if((!p||!p.getTime)||(!o.date||!o.date.getTime)||p.getTime()!=o.date.getTime()){this._trigger("changedate",this.element,p)}this.options.date=p;k=n._dateFirstDayOfWeek(p);m=n._dateLastMilliOfWeek(p);o.calendarBeforeLoad(n.element);n.element.data("startDate",k);n.element.data("endDate",m);l=n.element.find(".wc-day-column-inner");n._updateDayColumnHeader(l);if(typeof o.data=="string"){if(o.loading){o.loading(true)}if(j){if(!b){j.abort()}else{j.onreadystatechange=null;j.abort();j=null;if(o.loading){o.loading(false)}}}var r=n._getJsonOptions();r[o.startParam||"start"]=Math.round(k.getTime()/1000);r[o.endParam||"end"]=Math.round(m.getTime()/1000);j=h.ajax({url:o.data,data:r,dataType:"json",error:function(s,u,t){if(t!="abort"&&s.status!=0){alert("unable to get data, error:"+u)}},success:function(s){n._renderEvents(s,l)},complete:function(){j=null;if(o.loading){o.loading(false)}}})}else{if(h.isFunction(o.data)){o.data(k,m,function(s){n._renderEvents(s,l)})}else{if(o.data){n._renderEvents(o.data,l)}}}n._disableTextSelect(l)},_drawCurrentHourLine:function(){var q=new Date(),n=this.options,l=n.businessHours;h(".wc-hourline",this.element).remove();if(l.limitDisplay&&q.getHours()>l.end){return}var o=l.limitDisplay?l.start:0;var m=q.getHours()-o+q.getMinutes()/60;var p=m*n.timeslotHeight*n.timeslotsPerHour;var k=h(".wc-scrollable-grid .wc-today",this.element).width()+3;h(".wc-scrollable-grid .wc-today",this.element).append(h("<div>",{"class":"wc-hourline",style:"top: "+p+"px; width: "+k+"px"}))},_updateDayColumnHeader:function(s){var t=this;var u=this.options;var q=t._cloneDate(t.element.data("startDate"));var m=u.showAsSeparateUsers&&u.users&&u.users.length;var p="ui-state-active wc-today";t.element.find(".wc-header td.wc-day-column-header").each(function(v,w){h(this).html(t._getHeaderDate(q));if(t._isToday(q)){h(this).addClass(p)}else{h(this).removeClass(p)}q=t._addDays(q,1)});q=t._cloneDate(t.element.data("startDate"));if(m){t.element.find(".wc-header td.wc-user-header").each(function(v,w){if(t._isToday(q)){h(this).addClass(p)}else{h(this).removeClass(p)}q=((v+1)%u.users.length)?q:t._addDays(q,1)})}q=t._cloneDate(t.element.data("startDate"));s.each(function(v,w){h(this).data("startDate",t._cloneDate(q));h(this).data("endDate",new Date(q.getTime()+(a)));if(t._isToday(q)){h(this).parent().addClass(p).removeClass("ui-state-default")}else{h(this).parent().removeClass(p).addClass("ui-state-default")}if(!m||!((v+1)%u.users.length)){q=t._addDays(q,1)}});if(u.displayFreeBusys){q=t._cloneDate(t.element.data("startDate"));t.element.find(".wc-grid-row-freebusy .wc-column-freebusy").each(function(v,w){h(this).data("startDate",t._cloneDate(q));h(this).data("endDate",new Date(q.getTime()+(a)));if(!m||!((v+1)%u.users.length)){q=t._addDays(q,1)}})}if(this.options.title){var n=this.options.date,l=t._cloneDate(t.element.data("startDate")),o=t._dateLastDayOfWeek(new Date(this._cloneDate(t.element.data("endDate")).getTime()-(a))),r=this._getCalendarTitle(),k=u.dateFormat;r=r.replace("%start%",t._formatDate(l,k));r=r.replace("%end%",t._formatDate(o,k));r=r.replace("%date%",t._formatDate(n,k));h(".wc-toolbar .wc-title",t.element).html(r)}},_getCalendarTitle:function(){if(h.isFunction(this.options.title)){return this.options.title(this.options.daysToShow)}return this.options.title||""},_renderEvents:function(q,l){var m=this;var o=this.options;var n,r=0;if(q.options){var p=false;h.each(q.options,function(s,t){if(t!==o[s]){o[s]=t;p=p||h.ui.weekCalendar.updateLayoutOptions[s]}});m._computeOptions();if(p){var k=m._getCurrentScrollHour();m.element.empty();m._renderCalendar();l=m.element.find(".wc-time-slots .wc-day-column-inner");m._updateDayColumnHeader(l);m._resizeCalendar();m._scrollToHour(k,false)}}this._clearCalendar();if(h.isArray(q)){n=m._cleanEvents(q)}else{if(q.events){n=m._cleanEvents(q.events);m._renderFreeBusys(q)}}h.each(n,function(x,A){var w=new Date(A.start);var C=new Date(A.end);var u=m.options.businessHours.limitDisplay?m.options.businessHours.end:24;var y=m.options.businessHours.limitDisplay?m.options.businessHours.start:0;var t=new Date(w);var v=m._formatDate(t,"Ymd");var z=m._formatDate(C,"Ymd");var s;var B=false;while(v<z){A.start=t;A.end.setFullYear(t.getFullYear());A.end.setDate(t.getDate());A.end.setMonth(t.getMonth());A.end.setHours(u,0,0);if((s=m._findWeekDayForEvent(A,l))){m._renderEvent(A,s);r+=1}t.setDate(t.getDate()+1);t.setHours(y,0,0);v=m._formatDate(t,"Ymd");B=true}if(t<=C){A.start=t;A.end=C;if(((B&&A.start.getTime()!=A.end.getTime())||!B)&&(s=m._findWeekDayForEvent(A,l))){m._renderEvent(A,s);r+=1}}A.start=w});l.each(function(){m._adjustOverlappingEvents(h(this))});o.calendarAfterLoad(m.element);i&&clearInterval(i);if(o.hourLine){m._drawCurrentHourLine();i=setInterval(function(){m._drawCurrentHourLine()},60*1000)}!r&&o.noEvents()},_renderEvent:function(r,k){var l=this;var n=this.options;if(r.start.getTime()>r.end.getTime()){return}var p,m,o,q;p=r.id?"wc-cal-event":"wc-cal-event wc-new-cal-event";m='<div class="'+p+' ui-corner-all">';m+='<div class="wc-time ui-corner-top"></div>';m+='<div class="wc-title"></div></div>';k.each(function(){var s=h(m);q=n.eventRender(r,s);s=q?q.appendTo(h(this)):s.appendTo(h(this));s.css({lineHeight:(n.textSize+2)+"px",fontSize:n.textSize+"px"});l._refreshEventDetails(r,s);l._positionEvent(h(this),s);if(o){o=o.add(s)}else{o=s}});o.show();if(!n.readonly&&n.resizable(r,o)){l._addResizableToCalEvent(r,o,k)}if(!n.readonly&&n.draggable(r,o)){l._addDraggableToCalEvent(r,o)}n.eventAfterRender(r,o);return o},addEvent:function(){return this._renderEvent.apply(this,arguments)},_adjustOverlappingEvents:function(k){var l=this;if(l.options.allowCalEventOverlap){var m=l._groupOverlappingEventElements(k);h.each(m,function(){var n=this;h.each(n,function(q){var r=this;if(l.options.overlapEventsSeparate){var p=l.options.totalEventsWidthPercentInOneColumn/n.length;var o=q*p}else{var p=l.options.totalEventsWidthPercentInOneColumn-((n.length-1)*10);var o=q*10}h.each(r,function(){if(!l.options.overlapEventsSeparate){h(this).bind("mouseover.z-index",function(){var s=h(this);h.each(r,function(){h(this).css({"z-index":"1"})});s.css({"z-index":"3"})})}h(this).css({width:p+"%",left:o+"%",right:0})})})})}},_groupOverlappingEventElements:function(l){var o=l.find(".wc-cal-event:visible");var n=o.sort(function(s,r){return h(s).data("calEvent").start.getTime()-h(r).data("calEvent").start.getTime()});var p=new Date(0,0,0);var k=[];var q=[];var m;h.each(n,function(){m=h(this);if(q.length>0){if(p.getTime()<=m.data("calEvent").start.getTime()){k.push(q);q=[]}}for(var r=0;r<q.length;r++){if(q[r].length>0){if(q[r][q[r].length-1].data("calEvent").end.getTime()<=m.data("calEvent").start.getTime()){q[r].push(m);if(p.getTime()<m.data("calEvent").end.getTime()){p=m.data("calEvent").end}return}}}q.push([m]);if(p.getTime()<m.data("calEvent").end.getTime()){p=m.data("calEvent").end}});if(q.length>0){k.push(q)}return k},_findWeekDayForEvent:function(p,m){var k,o=this.options,l=o.showAsSeparateUsers&&o.users&&o.users.length,n=this._getEventUserId(p);if(!h.isArray(n)){n=[n]}m.each(function(q,r){if(h(this).data("startDate").getTime()<=p.start.getTime()&&h(this).data("endDate").getTime()>=p.end.getTime()&&(!l||h.inArray(h(this).data("wcUserId"),n)!==-1)){if(k){k=k.add(h(r))}else{k=h(r)}}});return k},_updateEventInCalendar:function(m){var k=this;k._cleanEvent(m);if(m.id){k.element.find(".wc-cal-event").each(function(){if(h(this).data("calEvent").id===m.id||h(this).hasClass("wc-new-cal-event")){h(this).remove()}})}var l=k._findWeekDayForEvent(m,k.element.find(".wc-grid-row-events .wc-day-column-inner"));if(l){l.each(function(p,o){var n=h(o);var q=k._renderEvent(m,n);k._adjustForEventCollisions(n,q,m,m);k._refreshEventDetails(m,q);k._positionEvent(n,q);k._adjustOverlappingEvents(n)})}},_positionEvent:function(m,p){var t=this.options;var s=p.data("calEvent");var q=m.height()/t.millisToDisplay;var n=t.businessHours.limitDisplay?t.businessHours.start:0;var o=this._getDSTdayShift(s.start).getTime()-this._getDSTdayShift(new Date(s.start.getFullYear(),s.start.getMonth(),s.start.getDate(),n)).getTime();var l=this._getDSTdayShift(s.end).getTime()-this._getDSTdayShift(s.start).getTime();var r=q*o;var k=q*l;p.css({top:r,height:k||(q*3600000/t.timeslotsPerHour)})},_getEventDurationFromPositionedEventElement:function(l,p,o){var n=this.options;var k=n.businessHours.limitDisplay?n.businessHours.start*3600000:0;var q=new Date(l.data("startDate").getTime()+k+Math.round(o/n.timeslotHeight)*n.millisPerTimeslot);var m=new Date(q.getTime()+(p.height()/n.timeslotHeight)*n.millisPerTimeslot);return{start:this._getDSTdayShift(q,-1),end:this._getDSTdayShift(m,-1)}},_adjustForEventCollisions:function(l,o,p,n,m){var s=this.options;if(s.allowCalEventOverlap){return}var r,k;var q=this;l.find(".wc-cal-event").not(o).each(function(){var t=h(this).data("calEvent");if(p.start.getTime()<t.end.getTime()&&p.end.getTime()>=t.end.getTime()){r=t.end}if(p.end.getTime()>t.start.getTime()&&p.start.getTime()<=t.start.getTime()){k=t.start}if(n.resizable==false||(p.end.getTime()<=t.end.getTime()&&p.start.getTime()>=t.start.getTime())){r=n.start;k=n.end;return false}});p.start=r||p.start;if(r&&m){p.end=new Date(r.getTime()+(n.end.getTime()-n.start.getTime()));q._adjustForEventCollisions(l,o,p,n)}else{p.end=k||p.end}if(p.start.getTime()>=p.end.getTime()){p.start=n.start;p.end=n.end}o.data("calEvent",p)},_addDraggableToCalEvent:function(m,l){var k=this.options;l.draggable({handle:".wc-time",containment:"div.wc-time-slots",snap:".wc-day-column-inner",snapMode:"inner",snapTolerance:k.timeslotHeight-1,revert:"invalid",opacity:0.5,grid:[l.outerWidth()+1,k.timeslotHeight],start:function(n,o){var p=o.draggable||o.helper;k.eventDrag(m,p)}})},_addDroppableToWeekDay:function(k){var l=this;var m=this.options;k.droppable({accept:".wc-cal-event",drop:function(o,z){var t=z.draggable;var y=Math.round(parseInt(z.position.top));var q=l._getEventDurationFromPositionedEventElement(k,t,y);var x=t.data("calEvent");var A=h.extend(true,{},x,{start:q.start,end:q.end});var r=m.showAsSeparateUsers&&m.users&&m.users.length;if(r){var v=k.data("wcUserId");var p=l._getEventUserId(x);var u=h(z.draggable.parents(".wc-day-column-inner").get(0)).data("wcUserId");if(!h.isArray(p)){p=[p]}if(h.inArray(v,p)==-1){var w=h.inArray(u,p);p.splice(w,1);if(h.inArray(v,p)==-1){p.push(v)}}A=l._setEventUserId(A,((p.length==1)?p[0]:p))}l._adjustForEventCollisions(k,t,A,x,true);var B=l.element.find(".wc-day-column-inner");m.eventDrop(A,x,t);var n=l._renderEvent(A,l._findWeekDayForEvent(A,B));t.hide();t.data("preventClick",true);var s=l._findWeekDayForEvent(t.data("calEvent"),l.element.find(".wc-time-slots .wc-day-column-inner"));if(s.data("startDate")!=k.data("startDate")){l._adjustOverlappingEvents(s)}l._adjustOverlappingEvents(k);setTimeout(function(){t.remove()},1000)}})},_addResizableToCalEvent:function(o,n,k){var l=this;var m=this.options;n.resizable({grid:m.timeslotHeight,containment:k,handles:"s",minHeight:m.timeslotHeight,stop:function(r,s){var t=s.element;var q=new Date(t.data("calEvent").start.getTime()+Math.max(1,Math.round(s.size.height/m.timeslotHeight))*m.millisPerTimeslot);if(l._needDSTdayShift(t.data("calEvent").start,q)){q=l._getDSTdayShift(q,-1)}var p=h.extend(true,{},o,{start:o.start,end:q});l._adjustForEventCollisions(k,t,p,o);m.eventResize(p,o,t);l._refreshEventDetails(p,t);l._positionEvent(k,t);l._adjustOverlappingEvents(k);t.data("preventClick",true);setTimeout(function(){t.removeData("preventClick")},500)}});h(".ui-resizable-handle",n).text("=")},_refreshEventDetails:function(m,l){var k="";if(!this.options.readonly&&this.options.allowEventDelete&&this.options.deletable(m,l)){k='<div class="wc-cal-event-delete ui-icon ui-icon-close"></div>'}l.find(".wc-time").html(this.options.eventHeader(m,this.element)+k);l.find(".wc-title").html(this.options.eventBody(m,this.element));l.data("calEvent",m);this.options.eventRefresh(m,l)},_clearCalendar:function(){this.element.find(".wc-day-column-inner div").remove();this._clearFreeBusys()},_scrollToHour:function(l,n){var m=this;var o=this.options;var p=this.element.find(".wc-scrollable-grid");var q=l;if(m.options.businessHours.limitDisplay){if(l<=m.options.businessHours.start){q=0}else{if(l>=m.options.businessHours.end){q=m.options.businessHours.end-m.options.businessHours.start-1}else{q=l-m.options.businessHours.start}}}var k=this.element.find(".wc-grid-timeslot-header .wc-hour-header:eq("+q+")");p.animate({scrollTop:0},0,function(){var s=k.offset().top;var r=s-p.offset().top-k.outerHeight();if(n){p.animate({scrollTop:r},o.scrollToHourMillis)}else{p.animate({scrollTop:r},0)}})},_hourForIndex:function(k){if(k===0){return 12}else{if(k<13){return k}else{return k-12}}},_24HourForIndex:function(k){if(k===0){return"00:00"}else{if(k<10){return"0"+k+":00"}else{return k+":00"}}},_amOrPm:function(k){return k<12?"AM":"PM"},_isToday:function(l){var m=this._cloneDate(l);this._clearTime(m);var k=new Date();this._clearTime(k);return k.getTime()===m.getTime()},_cleanEvents:function(l){var k=this;h.each(l,function(m,n){k._cleanEvent(n)});return l},_cleanEvent:function(k){if(k.date){k.start=k.date}k.start=this._cleanDate(k.start);k.end=this._cleanDate(k.end);if(!k.end){k.end=this._addDays(this._cloneDate(k.start),1)}},_disableTextSelect:function(k){k.each(function(){if(h.browser.mozilla){h(this).css("MozUserSelect","none")}else{if(h.browser.msie){h(this).bind("selectstart",function(){return false})}else{h(this).mousedown(function(){return false})}}})},_dateFirstDayOfWeek:function(l){var k=this;var m=new Date(l.getFullYear(),l.getMonth(),l.getDate());var n=new Date(m);n.setDate(n.getDate()-k._getAdjustedDayIndex(m));return n},_dateLastDayOfWeek:function(m){var k=this;var n=new Date(m.getFullYear(),m.getMonth(),m.getDate());var o=new Date(n);var l=(k.options.daysToShow-1-k._getAdjustedDayIndex(n));o.setDate(o.getDate()+l);return o},_fixMinMaxDate:function(l){var m,n;l=this._cleanDate(l);if(this.options.minDate){m=this._cleanDate(this.options.minDate);m=new Date(m.getFullYear(),m.getMonth(),m.getDate());if(l.getTime()<m.getTime()){this._trigger("reachedmindate",this.element,l)}l=this._cleanDate(Math.max(l.getTime(),m.getTime()))}if(this.options.maxDate){n=this._cleanDate(this.options.maxDate);if(!this._startOnFirstDayOfWeek()){var k=n.getDate()-this.options.daysToShow+1;n=new Date(n.getFullYear(),n.getMonth(),k)}n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);if(l.getTime()>n.getTime()){this._trigger("reachedmaxdate",this.element,l)}l=this._cleanDate(Math.min(l.getTime(),n.getTime()))}return l},_getAdjustedDayIndex:function(l){if(!this._startOnFirstDayOfWeek()){return 0}var m=new Date(l.getFullYear(),l.getMonth(),l.getDate());var k=m.getDay();var n=[0,1,2,3,4,5,6];this._rotate(n,this._firstDayOfWeek());return n[k]},_firstDayOfWeek:function(){if(h.isFunction(this.options.firstDayOfWeek)){return this.options.firstDayOfWeek(this.element)}return this.options.firstDayOfWeek},_dateLastMilliOfWeek:function(k){var l=this._dateLastDayOfWeek(k);l=this._cloneDate(l);l.setDate(l.getDate()+1);return l},_clearTime:function(k){k.setHours(0);k.setMinutes(0);k.setSeconds(0);k.setMilliseconds(0);return k},_addDays:function(l,m,k){l.setDate(l.getDate()+m);if(k){return l}return this._clearTime(l)},_rotate:function(n,q){for(var m=n.length,q=(Math.abs(q)>=m&&(q%=m),q<0&&(q+=m),q),o,k;q;q=(Math.ceil(m/q)-1)*q-m+(m=q)){for(o=m;o>q;k=n[--o],n[o]=n[o-q],n[o-q]=k){}}return n},_cloneDate:function(k){return new Date(k.getTime())},_cleanDate:function(k){if(typeof k==="string"){if(!isNaN(Number(k))){return this._cleanDate(parseInt(k,10))}return Date.parse(k)||new Date(k)}if(typeof k=="number"){return new Date(k)}return k},_formatDate:function(l,o){var n="";for(var m=0;m<o.length;m++){var k=o.charAt(m);if(m!=0&&o.charAt(m-1)=="\\"){n+=k}else{if(this._replaceChars[k]){n+=this._replaceChars[k](l,this)}else{if(k!="\\"){n+=k}}}}return n},_replaceChars:{d:function(k){return(k.getDate()<10?"0":"")+k.getDate()},D:function(k,l){return l.options.shortDays[k.getDay()]},j:function(k){return k.getDate()},l:function(k,l){return l.options.longDays[k.getDay()]},N:function(l){var k=l.getDay();return k?k:7},S:function(k){return(k.getDate()%10==1&&k.getDate()!=11?"st":(k.getDate()%10==2&&k.getDate()!=12?"nd":(k.getDate()%10==3&&k.getDate()!=13?"rd":"th")))},w:function(k){return k.getDay()},z:function(k){var l=new Date(k.getFullYear(),0,1);return Math.ceil((k-l)/86400000)},W:function(k){var l=new Date(k.getFullYear(),0,1);return Math.ceil((((k-l)/86400000)+l.getDay()+1)/7)},F:function(k,l){return l.options.longMonths[k.getMonth()]},m:function(k){return(k.getMonth()<9?"0":"")+(k.getMonth()+1)},M:function(k,l){return l.options.shortMonths[k.getMonth()]},n:function(k){return k.getMonth()+1},t:function(k){var l=k;return new Date(l.getFullYear(),l.getMonth()+1,0).getDate()},L:function(k){var l=k.getFullYear();return(l%400==0||(l%100!=0&&l%4==0))},o:function(k){var l=new Date(k.valueOf());l.setDate(l.getDate()-((k.getDay()+6)%7)+3);return l.getFullYear()},Y:function(k){return k.getFullYear()},y:function(k){return(""+k.getFullYear()).substr(2)},a:function(k){return k.getHours()<12?"am":"pm"},A:function(k){return k.getHours()<12?"AM":"PM"},B:function(k){return Math.floor((((k.getUTCHours()+1)%24)+k.getUTCMinutes()/60+k.getUTCSeconds()/3600)*1000/24)},g:function(k){return k.getHours()%12||12},G:function(k){return k.getHours()},h:function(k){return((k.getHours()%12||12)<10?"0":"")+(k.getHours()%12||12)},H:function(k){return(k.getHours()<10?"0":"")+k.getHours()},i:function(k){return(k.getMinutes()<10?"0":"")+k.getMinutes()},s:function(k){return(k.getSeconds()<10?"0":"")+k.getSeconds()},u:function(l){var k=l.getMilliseconds();return(k<10?"00":(k<100?"0":""))+k},e:function(k){return"Not Yet Supported"},I:function(k){return"Not Yet Supported"},O:function(k){return(-k.getTimezoneOffset()<0?"-":"+")+(Math.abs(k.getTimezoneOffset()/60)<10?"0":"")+(Math.abs(k.getTimezoneOffset()/60))+"00"},P:function(k){return(-k.getTimezoneOffset()<0?"-":"+")+(Math.abs(k.getTimezoneOffset()/60)<10?"0":"")+(Math.abs(k.getTimezoneOffset()/60))+":00"},T:function(n){var l=n.getMonth();n.setMonth(0);var k=n.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1");n.setMonth(l);return k},Z:function(k){return -k.getTimezoneOffset()*60},c:function(k,l){return l._formatDate(k,"Y-m-d\\TH:i:sP")},r:function(k,l){return l._formatDate(k,"D, d M Y H:i:s O")},U:function(k){return k.getTime()/1000}},getUserForId:function(k){return h.extend({},this.options.users[this._getUserIndexFromId(k)])},_getUserName:function(n){var l=this;var m=this.options;var k=m.users[n];if(h.isFunction(m.getUserName)){return m.getUserName(k,n,l.element)}else{return k}},_getUserIdFromIndex:function(m){var k=this;var l=this.options;if(h.isFunction(l.getUserId)){return l.getUserId(l.users[m],m,k.element)}return m},_getUserIndexFromId:function(n){var k=this;var l=this.options;for(var m=0;m<l.users.length;m++){if(k._getUserIdFromIndex(m)==n){return m}}return 0},_getEventUserId:function(m){var k=this;var l=this.options;if(l.showAsSeparateUsers&&l.users&&l.users.length){if(h.isFunction(l.getEventUserId)){return l.getEventUserId(m,k.element)}return m.userId}return[]},_setEventUserId:function(n,m){var k=this;var l=this.options;if(h.isFunction(l.setEventUserId)){return l.setEventUserId(m,n,k.element)}n.userId=m;return n},_getFreeBusyUserId:function(l){var k=this;var m=this.options;if(h.isFunction(m.getFreeBusyUserId)){return m.getFreeBusyUserId(l.getOption(),k.element)}return l.getOption("userId")},_clearFreeBusys:function(){if(this.options.displayFreeBusys){var l=this,m=this.options,k=l.element.find(".wc-grid-row-freebusy .wc-column-freebusy");k.each(function(){h(this).data("wcFreeBusyManager",new e({start:l._cloneDate(h(this).data("startDate")),end:l._cloneDate(h(this).data("endDate")),defaultFreeBusy:m.defaultFreeBusy||{}}))});l.element.find(".wc-grid-row-freebusy .wc-freebusy").remove()}},_findWeekDaysForFreeBusy:function(n,q){var p,o=this.options,l=o.showAsSeparateUsers&&o.users&&o.users.length,m=this,k=m._getFreeBusyUserId(n);if(!h.isArray(k)){k=k!="undefined"?[k]:[]}if(!q){q=m.element.find(".wc-grid-row-freebusy .wc-column-freebusy")}q.each(function(){var t=h(this).data("wcFreeBusyManager"),r=t.isWithin(n.getStart())||t.isWithin(n.getEnd())||n.isWithin(t.getStart())||n.isWithin(t.getEnd()),s=h(this).data("wcUserId");if(r&&(!l||(h.inArray(s,k)!=-1))){p=p?p.add(h(this)):h(this)}});return p},_renderFreeBusys:function(m){if(this.options.displayFreeBusys){var l=this,k=l.element.find(".wc-grid-row-freebusy .wc-column-freebusy"),n;if(h.isArray(m)){n=l._cleanFreeBusys(m)}else{if(m.freebusys){n=l._cleanFreeBusys(m.freebusys)}else{n=[]}}h.each(n,function(p,q){var o=l._findWeekDaysForFreeBusy(q,k);if(o){o.each(function(){var r=h(this).data("wcFreeBusyManager");r.insertFreeBusy(new d(q.getOption()));h(this).data("wcFreeBusyManager",r)})}});l._refreshFreeBusys(k)}},_refreshFreeBusys:function(l){if(this.options.displayFreeBusys&&l){var m=this,n=this.options,o=(n.businessHours.limitDisplay?n.businessHours.start:0),k=(n.businessHours.limitDisplay?n.businessHours.end:24);l.each(function(){var q=h(this);var p=m._cloneDate(q.data("startDate")),r=m._cloneDate(p);p.setHours(o);r.setHours(k);q.find(".wc-freebusy").remove();h.each(q.data("wcFreeBusyManager").getFreeBusys(p,r),function(){m._renderFreeBusy(this,q)})})}},_renderFreeBusy:function(l,p){if(this.options.displayFreeBusys){var k=this,m=this.options,o='<div class="wc-freebusy"></div>';var n=h(o);n.data("wcFreeBusy",new d(l.getOption()));this._positionFreeBusy(p,n);n=m.freeBusyRender(l.getOption(),n,k.element);if(n){n.appendTo(p)}}},_positionFreeBusy:function(q,m){var t=this.options;var s=m.data("wcFreeBusy");var p=q.height()/t.millisToDisplay;var n=t.businessHours.limitDisplay?t.businessHours.start:0;var o=s.getStart().getTime()-new Date(s.getStart().getFullYear(),s.getStart().getMonth(),s.getStart().getDate(),n).getTime();var l=s.getEnd().getTime()-s.getStart().getTime();var r=p*o;var k=p*l;m.css({top:r,height:k})},_cleanFreeBusys:function(m){var k=this,l=[];if(!h.isArray(m)){var m=[m]}h.each(m,function(n,o){l.push(new d(k._cleanFreeBusy(o)))});return l},_cleanFreeBusy:function(k){if(k.date){k.start=k.date}k.start=this._cleanDate(k.start);k.end=this._cleanDate(k.end);return k},getFreeBusyManagersFor:function(k,m){var l={start:k,end:k};this._setEventUserId(l,m);return this.getFreeBusyManagerForEvent(l)},getFreeBusyManagerForEvent:function(q){var m=this,o=this.options,r;if(o.displayFreeBusys){var n=m.element.find(".wc-grid-row-freebusy .wc-column-freebusy"),l=new d({start:q.start,end:q.end}),k=o.showAsSeparateUsers&&o.users&&o.users.length,p=k?m._getEventUserId(q):null;if(!h.isArray(p)){p=[p]}n.each(function(){var t=h(this).data("wcFreeBusyManager"),s=t.isWithin(l.getEnd())||t.isWithin(l.getEnd())||l.isWithin(t.getStart())||l.isWithin(t.getEnd());if(s&&(!k||h.inArray(h(this).data("wcUserId"),p)!=-1)){r=h(this).data("wcFreeBusyManager");return false}})}return r},updateFreeBusy:function(n){var k=this,m=this.options;if(m.displayFreeBusys){var p,l=k.element.find(".wc-grid-row-freebusy .wc-column-freebusy"),o=k._cleanFreeBusys(n);h.each(o,function(r,q){var s=k._findWeekDaysForFreeBusy(q,l);if(s&&s.length){s.each(function(u,t){var v=h(t).data("wcFreeBusyManager");v.insertFreeBusy(q);h(t).data("wcFreeBusyManager",v)});p=p?p.add(s):s}});k._refreshFreeBusys(p)}},_startOnFirstDayOfWeek:function(){return jQuery.isFunction(this.options.startOnFirstDayOfWeek)?this.options.startOnFirstDayOfWeek(this.element):this.options.startOnFirstDayOfWeek},_getCurrentScrollHour:function(){var l=this;var m=this.options;var n=this.element.find(".wc-scrollable-grid");var k=n.scrollTop();if(l.options.businessHours.limitDisplay){k=k+m.businessHours.start*m.timeslotHeight*m.timeslotsPerHour}return Math.round(k/(m.timeslotHeight*m.timeslotsPerHour))+1},_getJsonOptions:function(){if(h.isFunction(this.options.jsonOptions)){return h.extend({},this.options.jsonOptions(this.element))}if(h.isPlainObject(this.options.jsonOptions)){return h.extend({},this.options.jsonOptions)}return{}},_getHeaderDate:function(m){var l=this.options;if(l.getHeaderDate&&h.isFunction(l.getHeaderDate)){return l.getHeaderDate(m,this.element)}var k=l.useShortDayNames?l.shortDays[m.getDay()]:l.longDays[m.getDay()];return k+(l.headerSeparator)+this._formatDate(m,l.dateFormat)},_getDSTdayShift:function(l,k){var o=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0);var n=o.getTimezoneOffset();var m=l.getTimezoneOffset();if(n==m){return l}k=k?k:1;return new Date(l.getTime()-k*(n>m?-1:1)*(Math.max(n,m)-Math.min(n,m))*60000)},_needDSTdayShift:function(l,k){return l.getTimezoneOffset()!=k.getTimezoneOffset()}}})());h.extend(h.ui.weekCalendar,{version:"2.0-dev",updateLayoutOptions:{startOnFirstDayOfWeek:true,firstDayOfWeek:true,daysToShow:true,displayOddEven:true,timeFormat:true,dateFormat:true,use24Hour:true,useShortDayNames:true,businessHours:true,timeslotHeight:true,timeslotsPerHour:true,buttonText:true,height:true,shortMonths:true,longMonths:true,shortDays:true,longDays:true,textSize:true,users:true,showAsSeparateUsers:true,displayFreeBusys:true}});var a=86400000;var c=a*7;var f={getStart:function(){return this.getOption("start")},getEnd:function(){return this.getOption("end")},getOption:function(){if(!arguments.length){return this.options}if(typeof(this.options[arguments[0]])!=="undefined"){return this.options[arguments[0]]}else{if(typeof(arguments[1])!=="undefined"){return arguments[1]}}return null},setOption:function(i,j){if(arguments.length==1){h.extend(this.options,arguments[0]);return this}this.options[i]=j;return this},isWithin:function(i){return Math.floor(i.getTime()/1000)>=Math.floor(this.getStart().getTime()/1000)&&Math.floor(i.getTime()/1000)<=Math.floor(this.getEnd().getTime()/1000)},isValid:function(){return this.getStart().getTime()<this.getEnd().getTime()}};var d=function(i){this.options=h.extend({},i||{})};h.extend(d.prototype,f);var e=function(i){this.options=h.extend({defaultFreeBusy:{}},i||{});this.freeBusys=[];this.freeBusys.push(new d(h.extend({start:this.getStart(),end:this.getEnd()},this.options.defaultFreeBusy)))};h.extend(e.prototype,f,{getFreeBusys:function(){switch(arguments.length){case 0:return this.freeBusys;case 1:var j=[];var l=arguments[0];if(!this.isWithin(l)){return j}h.each(this.freeBusys,function(){if(this.isWithin(l)){j.push(this)}if(Math.floor(this.getEnd().getTime()/1000)>Math.floor(l.getTime()/1000)){return false}});return j;default:var j=[];var l=arguments[0],i=arguments[1];var k=new d({start:l,end:i});if(i.getTime()<l.getTime()||this.getStart().getTime()>i.getTime()||this.getEnd().getTime()<l.getTime()){return j}h.each(this.freeBusys,function(){if(this.getStart().getTime()>=i.getTime()){return false}if(k.isWithin(this.getStart())&&k.isWithin(this.getEnd())){j.push(this)}else{if(this.isWithin(k.getStart())&&this.isWithin(k.getEnd())){var m=new d(this.getOption());m.setOption("end",k.getEnd());m.setOption("start",k.getStart());j.push(m)}else{if(this.isWithin(k.getStart())&&this.getStart().getTime()<l.getTime()){var m=new d(this.getOption());m.setOption("start",k.getStart());j.push(m)}else{if(this.isWithin(k.getEnd())&&this.getEnd().getTime()>i.getTime()){var m=new d(this.getOption());m.setOption("end",k.getEnd());j.push(m)}}}}});return j}},insertFreeBusy:function(j){var j=new d(j.getOption());if(j.getStart().getTime()<this.getStart().getTime()){j.setOption("start",this.getStart())}if(j.getEnd().getTime()>this.getEnd().getTime()){j.setOption("end",this.getEnd())}var p=j.getStart(),i=j.getEnd(),n=0,m=this.freeBusys.length-1,o=[];var l=function(q){if(q.isValid()){o.push(q)}};h.each(this.freeBusys,function(s){var q=this;if(q.isWithin(p)&&q.isWithin(i)){n=s;m=s;if(p.getTime()==q.getStart().getTime()&&i.getTime()==q.getEnd().getTime()){var u=new d(j.getOption());l(u)}else{if(p.getTime()==q.getStart().getTime()){var u=new d(j.getOption());var t=new d(q.getOption());t.setOption("start",i);l(u);l(t)}else{if(i.getTime()==q.getEnd().getTime()){var u=new d(q.getOption());u.setOption("end",p);var t=new d(j.getOption());l(u);l(t)}else{var u=new d(q.getOption());var t=new d(j.getOption());var r=new d(q.getOption());u.setOption("end",p);r.setOption("start",i);l(u);l(t);l(r)}}}return false}else{if(q.isWithin(p)&&q.getEnd().getTime()!=p.getTime()){if(q.getStart().getTime()!=p.getTime()){var u=new d(q.getOption());u.setOption("end",p);l(u)}n=s}else{if(q.isWithin(i)&&q.getStart().getTime()!=i.getTime()){l(new d(j.getOption()));if(i.getTime()<q.getEnd().getTime()){var u=new d(q.getOption());u.setOption("start",i);l(u)}m=s;return false}}}});var k=this.freeBusys;this.freeBusys=[];if(n){this.freeBusys=this.freeBusys.concat(k.slice(0,n))}this.freeBusys=this.freeBusys.concat(o);if(m<k.length){this.freeBusys=this.freeBusys.concat(k.slice(m+1))}return this}})})(jQuery);